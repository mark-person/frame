<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
<link th:replace="base/mobile-fragment::common"/>

<script>

// 去掉默认loading
base.showLoading = function() {}
base.hideLoading = function() {}

</script>


<style>
body {margin-top:2.75rem;margin-bottom:3rem;font-size:0.865rem;}
#pageMsg p {text-align: center;}

.commodity-div {display:flex;justify-content:space-between;flex-wrap:wrap;margin-left:0.3rem;margin-right:0.3rem;}
.commodity-item-div {border:1px solid #DCDCDC;background-color:white;margin:0.225rem;border-radius:0.5rem;cursor: pointer;}
.commodity-img {max-width:100%;max-height:100%;}
.commodity-img-div {width:12rem;height:12rem;border-bottom:1px solid #DCDCDC;display:table-cell;vertical-align:middle;text-align:center;}
.commodity-title {width:12rem;display:-webkit-box !important; overflow:hidden;-webkit-line-clamp:1;-webkit-box-orient:vertical;font-size: 0.825rem;padding:0.2rem;}

</style>

</head>
<body>

<div id="pageDiv">
	<div class="commodity-div" style="border:1px solid #ddd;margin:-2px;">
		<div class="commodity-item-div" @click="view()" v-for="item in list" v-cloak>
			<div class="commodity-img-div">
				<img style="border-radius:0.4rem" src="" class="commodity-img">
			</div>
			<div class="commodity-title">{{item.testName}}</div>
		</div>
	</div>
	<div id="pageMsg" v-cloak>
		<div id="pageMore" v-if="pageMore"><p>-- 上拉加载更多 --</p></div>
		<div id="pageLoading" v-if="pageLoading"><p>-- 加载中... --</p></div>
		<div id="pageEnd" v-if="pageEnd"><p>-- 暂时就这么多了 --</p></div>
	</div>
</div>

<div>
<style type="text/css">
.main-menu {position:fixed;bottom: 0; background-color:#f0f0f0;width:25.875rem;;z-index:9999}
.main-div {display:flex;justify-content:space-between; padding:0.3rem 0.8rem 0.1rem 0.8rem;}
.main-item {text-align: center;color:gray;cursor:pointer;font-size: 0.815rem}
.main-item div {padding:-0.2rem;margin:0rem}
.main-activtiy {color:orange;}
</style>
<div class="main-menu" style="display: none">
<div class="main-div">
	<div class="main-item" id="home" onclick="gotoPage(this);">
		<div class="fa fa-home"></div><div>首页</div>
	</div>
	<div class="main-item" id="subject" onclick="gotoPage(this)">
		<div class="fa fa-asterisk"></div><div>专题</div>
	</div>
	<div class="main-item" id="my" onclick="gotoPage(this)">
		<div class="fa fa-user-circle"></div><div>我的</div>
	</div>
</div>
</div>
<script type="text/javascript" th:inline="javascript">

var data = [[${data}]];

var pageDiv = new Vue({
	el:'#pageDiv',
	data:{list:data.list, pageMore:false, pageLoading:false, pageEnd:false},
	methods:{
		view:function() {
			
		}
	}
})


var pageHasMore = true;
var currentPageNumber = 1;
window.onscroll = function(e) {
	var e = e || window.event;
	var scrolltop = document.documentElement.scrollTop || document.body.scrollTop;
	
	if (scrolltop + document.body.clientHeight >= window.innerHeight - 50) {
		if (pageHasMore) {
			pageHasMore = false;
			currentPageNumber++;
			
			pageDiv.pageMore = false;
			pageDiv.pageEnd = false;
			pageDiv.pageLoading = true;
			
			axios.post("base/router/test", {pageNumber:currentPageNumber}).then(function(res) {
				
				if (currentPageNumber == 1) {
					pageDiv.list = res.list;
				}
				else {
					for (var i = 0; i < res.list.length; i++) {
						pageDiv.list.push(res.list[i]);
					}
				}
				
				pageDiv.pageMore = false;
				pageDiv.pageEnd = false;
				pageDiv.pageLoading = false;
				
				if (res.page.pageSize * res.page.pageNumber < res.page.totalRows) {
					pageHasMore = true;
					pageDiv.pageMore = true;
				}
				else {
					pageDiv.pageEnd = true;
				}
				
		    });
		}
	}
}

</script>
</div>


</body>

</html>
